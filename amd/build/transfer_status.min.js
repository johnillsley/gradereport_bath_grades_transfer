define(["jquery","core/templates","core/ajax","core/config","core/yui"],function(a,b,c,d,e){var f=d.wwwroot+"/grade/report/transfer/ajax.php",g=function(a){var b=a.success,c=a.failed,d="Grades sent to SAMIS successfully : <span class='label-info label'>"+b+"</span>",f="Failed transfers : <span class='label-danger label'>"+c+"</span>",g=new M.core.dialogue({headerContent:"Summary",bodyContent:"<p>"+d+"</p><p>"+f+"</p>",draggable:!1,visible:!1,center:!0,modal:!0,width:400,closeButton:!0,closeButtonTitle:"Close"});g.addButton({label:"OK",action:function(a){a.preventDefault(),g.hide()},section:e.WidgetStdMod.FOOTER}),g.show()},h=function(b,c,d,e){var i=b[0],j=a("#confirm_transfer_table tbody").find("tr[data-moodle-user-id='"+i+"']"),k=j.find("td").find(".loadingDiv");k.show(),a.each(c,function(d,e){"users[]"===e.name&&c.splice(a.inArray(c[d],b),1)});var l={name:"users[]",value:i};c.push(l),a.ajax({type:"POST",dataType:"json",data:c,url:f}).done(function(f){if(j.attr("data-moodle-user-id")==f.userid&&("success"==f.status?(d++,a("#confirm_transfer_table tbody").find("tr[data-moodle-user-id='"+f.userid+"']").find(".transfer_status").removeClass("label-warning").addClass("label-success").html("Grade transferred to SAMIS")):"failure"==f.status&&(e++,a("#confirm_transfer_table tbody").find("tr[data-moodle-user-id='"+f.userid+"']").find(".transfer_status").html(f.reason))),k.hide(),b.splice(a.inArray(i,b),1),b.length>0)h(b,c,d,e);else{a("body").css("cursor","default");var l={success:d,failed:e};g(l)}})},i=function(b){var c=[];return a.each(b,function(b,d){var e=a(d).attr("data-moodle-user-id");c.push(e)}),c},j=function(b,c){c.preventDefault(),a(b).attr("disabled",!0),a("body").css("cursor","progress"),a("#confirm_transfer_table .transfer_status").removeClass().addClass("label label-warning transfer_status").html("");var e=a("#confirm_transfer_table tbody tr"),f=a("#transferconfirmed"),g=f.serializeArray();console.log(g),a(b).next().html("Go Back").attr("href",d.wwwroot+"/grade/report/transfer/index.php?id="+g[3].value);var j=i(e),k=0,l=0;h(j,g,k,l)};return{init:function(){a("#proceed_grade_transfer").click(function(a){j(this,a)})}}});